(function(window,undefined){"use strict";var mapInstance,geocoderInstance,mapMovingTimeout,updateLabelTimeout;var formatLabel=function(longitude,latitude){if(longitude>0){var longitudeLabel='째E';var newLongitude=longitude}else{var longitudeLabel='째W';var newLongitude=longitude.toString().slice(1)}
if(latitude>0){var latitudeLabel='째N';var newLatitude=latitude}else{var latitudeLabel='째S';var newLatitude=latitude.toString().slice(1)}
return parseFloat(newLatitude).toFixed(3)+latitudeLabel+' / '+parseFloat(newLongitude).toFixed(4)+longitudeLabel}
observer.subscribe("page/loaded",function(){mapboxgl.accessToken='pk.eyJ1IjoibWFnbnVzbG91dmVuaXIiLCJhIjoiY2s2aHdqOG42MDg5NzNubXN3emU4MzRnMCJ9.aONcbs-CH7LqCsl9h06kYA';mapInstance=new mapboxgl.Map({container:'map',style:'mapbox://styles/'+page.product.options.style[page.product.variation.style].mapboxStyle,center:[page.product.variation.longitude,page.product.variation.latitude],zoom:page.product.variation.zoom,animate:!1,scrollZoom:!1,pitchWithRotate:!1,boxZoom:!1,dragRotate:!1,fadeDuration:0,attributionControl:!1,minZoom:1,maxZoom:16,bearing:page.product.variation.bearing,keyboard:!1,});geocoderInstance=new MapboxGeocoder({accessToken:mapboxgl.accessToken,language:page.language,flyTo:!1});try{document.getElementById('geocoder').appendChild(geocoderInstance.onAdd(mapInstance))}catch(err){}
mapInstance.on('zoomend',(e)=>{var cords=mapInstance.getCenter();var zoom=mapInstance.getZoom();page.product.variation.zoom=zoom;page.product.variation.longitude=cords.lng;page.product.variation.latitude=cords.lat;page.product.variation.bearing=mapInstance.getBearing();if(page.product.variation.labelUpdateCoordinate=="checked"){page.product.variation.labelLocation=formatLabel(cords.lng,cords.lat);$('[data-key="labelLocation"]').val(page.product.variation.labelLocation);observer.publish("labels/change")}});mapInstance.on('load',()=>{geocoderInstance.on('result',(ev)=>{mapInstance.jumpTo({center:ev.result.center,zoom:11,});page.product.variation.zoom=11;var cords=mapInstance.getCenter();page.product.variation.longitude=cords.lng;page.product.variation.latitude=cords.lat;page.product.variation.bearing=mapInstance.getBearing();page.product.variation.labelTitle=ev.result.text;page.product.variation.labelSubTitle=ev.result.context[ev.result.context.length-1].text;$('[data-key="labelTitle"]').val(page.product.variation.labelTitle);$('[data-key="labelSubTitle"]').val(page.product.variation.labelSubTitle);if(page.product.variation.labelUpdateCoordinate=="checked"){page.product.variation.labelLocation=formatLabel(cords.lng,cords.lat);$('[data-key="labelLocation"]').val(page.product.variation.labelLocation)}
observer.publish("labels/change")})});mapInstance.on('moveend',(ev)=>{var cords=mapInstance.getCenter();page.product.variation.longitude=cords.lng;page.product.variation.latitude=cords.lat;page.product.variation.bearing=mapInstance.getBearing();if(page.product.variation.labelUpdateCoordinate=="checked"){page.product.variation.labelLocation=formatLabel(cords.lng,cords.lat);$('[data-key="labelLocation"]').val(page.product.variation.labelLocation);observer.publish("labels/change")}});observer.subscribe("map/zoomin",function(obj){var zoomLevel=Math.round(mapInstance.getZoom()+1);mapInstance.setZoom(zoomLevel);page.product.variation.zoom=parseInt(mapInstance.getZoom())});observer.subscribe("map/zoomout",function(obj){var zoomLevel=Math.round(mapInstance.getZoom()-1);mapInstance.setZoom(zoomLevel);page.product.variation.zoom=parseInt(mapInstance.getZoom())})});observer.subscribe("product/configuration/updated",function(obj){if(obj.key=="size"){debounce(function(){mapInstance.resize()},250)()}else if(obj.key=="style"){mapInstance.setStyle('mapbox://styles/'+page.product.options.style[page.product.variation.style].mapboxStyle)}})})(this)